{% assign sorted_repos = (site.github.nodecontributors)  %}
<div id="container-open-source">
  <section class="container">
    <canvas id="myChart" width="800" height="400"></canvas>
    <div id="contributors">
      {{site.github.nodecontributors.totalUsers}}
    </div>
  </section>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.6/Chart.bundle.min.js"></script>
<script>
$(document).ready(function(){
  var ctx = document.getElementById("myChart").getContext("2d");

  function createChart (data) {
    var DownloadsArray = $.map(data.monthlyDownloads, function(value, index) {
      return [value];
    });
    var myChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ["April", "May", "June", "July"],
        datasets: [{
          label: '# of Downloads',
          data: DownloadsArray,
          backgroundColor: [
            'rgba(255, 99, 132, 0.2)',
            'rgba(54, 162, 235, 0.2)',
            'rgba(255, 206, 86, 0.2)',
            'rgba(75, 192, 192, 0.2)',
          ],
          borderColor: [
            'rgba(255,99,132,1)',
            'rgba(54, 162, 235, 1)',
            'rgba(255, 206, 86, 1)',
            'rgba(75, 192, 192, 1)',
          ],
          borderWidth: 1
        }]
      },
      options: {
        scales: {
          yAxes: [{
            ticks: {
              beginAtZero:true
            }
          }]
        }
      }
    });
  }

  function createPackageBox(data){
    data.packages.map(function(package){
      var mainAnchor = $('<a>').addClass('main-anchor col-sm-6 col-md-4').attr('href', 'https://www.npmjs.com/package/'+package.name);
      $('<span>').addClass('package-name').text(package.name).appendTo(mainAnchor);
      $('#contributors').append(mainAnchor);
    })
  }

  $.ajax({
    url: "/jsonStore.json",
    dataType: "json"
  })
  .done(function(data){
    createChart(data);
    createPackageBox(data);
    console.log(data);
  })

  // Enable bootstrap tooltip
  $("body").tooltip({ selector: '[data-toggle=tooltip]' });

  $('.geopattern').each(function(){
    $(this).geopattern($(this).data('pattern-id'));
  });

});
</script>
